{% extends 'core/base.html' %}
{% load cpf_format %}
{% load phone_format %}

{% block content %}
<div class="bg-midnight text-text-primary rounded-2xl p-6 m-6 shadow-lg">
    
    <!-- filters and buttons -->
    <form method="get" class="flex justify-between items-end flex-wrap gap-4 mb-6">
        
        <!-- filters -->
        <div class="flex flex-wrap items-end gap-4">
            <div>
                <label for="name" class="block text-sm text-text-muted">Nome</label>
                <input
                    type="text"
                    name="name"
                    id="name"
                    value="{{ request.GET.name }}"
                    class="bg-input-bg border border-input-border text-text-primary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-faint-violet"
                >
            </div>
            
            <div>
                <label for="customer_group" class="block text-sm text-text-muted">Grupo</label>
                <select
                    name="customer_group"
                    id="customer_group"
                    class="bg-input-bg border border-input-border text-text-primary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-faint-violet"
                >
                    <option value="">Todos</option>
                    {% for group in customer_groups %}
                        <option value="{{ group }}" {% if request.GET.customer_group == group %}selected{% endif %}>
                            {{ group|title }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- buttons -->
        <div class="flex gap-2 ml-auto">
            <button
                type="submit"
                name="export"
                value="1"
                class="bg-slate-border hover:bg-input-border text-white px-4 py-2 rounded-lg transition"
            >
                Exportar XLSX
            </button>
            <button
                type="submit"
                class="bg-deep-violet hover:bg-faint-violet text-white px-4 py-2 rounded-lg transition"
            >
                Pesquisar
            </button>
        </div>

    </form>

    <!-- table -->
    <div class="flex flex-col gap-1 text-sm font-medium">
        <div class="grid grid-cols-[2fr_3fr_1.5fr_1.5fr_2fr] bg-black-pearl/50 text-text-muted px-4 py-3 rounded-md border border-slate-border uppercase tracking-wide text-xs">
            <div class="text-left">Nome</div>
            <div class="text-left">E-mail</div>
            <div class="text-left">CPF</div>
            <div class="text-left">Ãšltima Compra</div>
            <div class="text-left">Telefone</div>
        </div>

        {% for customer in page_obj %}
            <div class="grid grid-cols-[2fr_3fr_1.5fr_1.5fr_2fr] px-4 py-3 rounded-md border border-slate-border bg-black-pearl/50 hover:bg-black-pearl/70 transition">
                <div class="text-left">{{ customer.first_name }} {{ customer.last_name }}</div>
                <div class="text-left">{{ customer.email }}</div>
                <div class="text-left">{{ customer.cpf|format_cpf }}</div>
                <div class="text-left">{{ customer.last_order|date:"d/m/Y" }}</div>
                <div class="text-left">{{ customer.phone|format_phone }}</div>
            </div>
        {% empty %}
            <div class="text-center text-text-muted px-4 py-6">Nenhum item encontrado.</div>
        {% endfor %}
    </div>

    {% include 'core/partials/_pagination_controls.html' %}

</div>
{% endblock content %}
